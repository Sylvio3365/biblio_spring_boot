<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Mes prÃªts en cours</title>
</head>

<body>
    <h2>ğŸ“š Mes prÃªts en cours</h2>

    <!-- ğŸ“ Tableau des prÃªts -->
    <table border="1" cellpadding="10" cellspacing="0">
        <thead>
            <tr>
                <th>#</th>
                <th>Titre du livre</th>
                <th>NumÃ©ro exemplaire</th>
                <th>Date de dÃ©but</th>
                <th>Date de fin prÃ©vue</th>
                <th>Type de prÃªt</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="dto, stat : ${mesprets}">
                <td th:text="${stat.count}">1</td>
                <td th:text="${dto.pret.exemplaire.livre.titre}">Titre</td>
                <td th:text="${dto.pret.exemplaire.numero}">EX123</td>
                <td th:text="${#temporals.format(dto.pret.debut, 'dd/MM/yyyy')}">01/01/2025</td>
                <td th:text="${#temporals.format(dto.pret.fin, 'dd/MM/yyyy')}">15/01/2025</td>
                <td th:text="${dto.pret.typepret.nom}">Normal</td>
                <td>
                    <!-- âœ… Cas 1 : prÃªt prolongeable, pas encore prolongÃ© -->
                    <div th:if="${dto.pret.typepret.idtypepret != 2 and dto.prolongement == null}">
                        <form th:action="@{/prolongement/demande}" method="post">
                            <input type="hidden" name="idPret" th:value="${dto.pret.idpret}" />
                            <label for="nouveaufin">Nouvelle date de fin :</label>
                            <input type="date" id="nouveaufin" name="nouveaufin" required />
                            <button type="submit">â³ Prolonger</button>
                        </form>
                    </div>

                    <!-- âœ… Cas 2 : prÃªt dÃ©jÃ  prolongÃ© -->
                    <div th:if="${dto.prolongement != null}">
                        âœ… ProlongÃ© jusqu'au :
                        <span
                            th:text="${#temporals.format(dto.prolongement.nouveaufin, 'dd/MM/yyyy')}">20/01/2025</span>
                        <br />
                        ğŸŸ¡ Statut :
                        <span th:text="${dto.statutProlongement.statut.nom}">En attente</span>
                    </div>

                    <!-- âœ… Cas 3 : prÃªt non prolongeable -->
                    <div th:if="${dto.pret.typepret.idtypepret == 2}">
                        Aucune action possible
                    </div>
                </td>
            </tr>

            <tr th:if="${#lists.isEmpty(mesprets)}">
                <td colspan="7">Aucun prÃªt en cours.</td>
            </tr>

        </tbody>
    </table>

    <!-- âœ… Messages -->
    <div th:if="${error}" style="color: red;">
        <p th:text="${error}">Erreur</p>
    </div>
    <div th:if="${success}" style="color: green;">
        <p th:text="${success}">SuccÃ¨s</p>
    </div>

    <br />
    <a th:href="@{/goAccueil}">ğŸ  Retour Ã  l'accueil</a>
</body>

</html>